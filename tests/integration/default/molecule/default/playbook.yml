---

- name: Coverage
  hosts: all
  pre_tasks:
    - name: Dump all hostvars
      debug:
        var: hostvars[inventory_hostname]
    - name: List all services (systemd)
      # workaround ansible-lint: [303] service used in place of service module
      shell: "echo; systemctl list-units --type service"
      changed_when: false
      when:
        # in docker, init is not systemd
        - ansible_virtualization_type != 'docker'
        - ansible_os_family == 'RedHat' or ansible_os_family == 'Debian'
    - name: list all services (FreeBSD service)
      # workaround ansible-lint: [303] service used in place of service module
      shell: "echo; service -l"
      changed_when: false
      when:
        - ansible_os_family == 'FreeBSD'
    - name: list all services (rcctl)
      command: "rcctl ls all"
      changed_when: false
      when:
        - ansible_os_family == 'OpenBSD'
  roles:
    - role: client
      when: ansible_hostname == 'client1'
    - role: ansible-role-fluentd
  vars:
    shared_password: password
    fluentd_plugins_to_install:
      - fluent-plugin-secure-forward

    fluentd_ca_cert: |
      -----BEGIN CERTIFICATE-----
      MIIDIDCCAggCAQEwDQYJKoZIhvcNAQEFBQAwTTELMAkGA1UEBhMCVVMxCzAJBgNV
      BAgMAkNBMRYwFAYDVQQHDA1Nb3VudGFpbiBWaWV3MRkwFwYDVQQDDBBTZWN1cmVG
      b3J3YXJkIENBMB4XDTcwMDEwMTAwMDAwMFoXDTIxMTEyODAxNTYxOVowTTELMAkG
      A1UEBhMCVVMxCzAJBgNVBAgMAkNBMRYwFAYDVQQHDA1Nb3VudGFpbiBWaWV3MRkw
      FwYDVQQDDBBTZWN1cmVGb3J3YXJkIENBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
      MIIBCgKCAQEAn20jowErdTLA/pE6DGq+zIMbgghbyj67B/Z47oTyvFsWQ/ohh7md
      mP0RUZMQXBqOJs0kNcJrcYP7i/q2fQULUbMZ2K0fjkP0UNKQsJdTBxlov+kAJuXn
      aQEuoctyssz1n6a0aeX/HwNVX247fFOmPmjU7mbb5v7dztUZ01/tL91+kH52AuoV
      SJjvBx2casnmknY+qba1qrcSlVdty0g6FYb5En2wooPnrs6wE78sEgLUjvBXhcA4
      dZUsLP4JsINM17rhZjpPl/0iclCfwTCie91BXz5jnAdoC5rIunyXeI5CjGGQLHM7
      pxHUtnXD4R30sTix89XlNcZbLbC0ptQArwIDAQABoxAwDjAMBgNVHRMEBTADAQH/
      MA0GCSqGSIb3DQEBBQUAA4IBAQB5bym2hN1f2zhvPEXUfjLPPKF34SjdXOzVrWQm
      ywoUZSg3DwsJatR7AvbLY2fguFvHexxyyb+To4OeNUDFYdhMkq9TDg0gdrqv0tQf
      xTqymVJRUJB/NN1hFLioqTEEXYS2VJSG3LyKgwWX0d+wSC26IM9FTgjE74WXNcfR
      GDnsLYcTGRIUdgQLiBgRgKvybvacbLtieWDwCW+oay0mxuE90kB60WTKQWiiNweV
      CSyHXrOOqXFa6xunsKvBD2DlFzAjPjRWECiPY4izb3bQiugROm9mrBVvMKeO3cML
      SHLXMTgENqgIzae3tJCZhqNPf2KekKlx1GDkk244x/3FMwXK
      -----END CERTIFICATE-----
